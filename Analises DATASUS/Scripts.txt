setwd("C:/RelacionamentoBaseDatasus") #seleciona o diretório que o arquivo será trabalhado
getwd() #valida o diretorio

install.packages("read.dbc") #instala o pacote para leitura do arquivo .dbc
library(read.dbc) #chama a biblioteca read.dbc

sus <- read.dbc("C:/RelacionamentoBaseDatasus/ABSP1701.dbc") #seleciona o arquivo
View(sus) ## Gera uma View do Arquivo


install.packages("sqldf") #pacote para utilização do R com scripts de sql
library(sqldf) #chama a biblioteca sqldf


sql <- sqldf('select * from sus') #Exemplo de SQL


install.packages("xlsx") -- instalar o xlsx
library("xlsx")
write.xlsx(CIRURGIA,file = "CIRURGIA.xlsx") -- salvar a tabela em xlsx


rm(A2) # removar variavel do ambiente

/*Para extrair os dados dos outros sistemas do SIASUS que tem a mesma modelagem utilizamos o mesmo script alterando somente a fonte.*/

CIRURGIA <- sqldf('select 
				"LAYOUT CIRURGIAS" AS TIPO_DO_DADO,
				A.INICIO DATA_REGISTRO,
				CASE 
					WHEN RACACOR = "01" THEN "Branca" 
					WHEN RACACOR = "02" THEN "Preta"
					WHEN RACACOR = "03" THEN "Parda"
					WHEN RACACOR = "04" THEN "Amarela"
					WHEN RACACOR = "05" THEN "Indígena"
ELSE "Não Informado" END RACA,
				CASE
					WHEN SEXOPAC = "F" THEN "Feminino"
				ELSE "Masculino" END SEXO,
				A.IDADEPAC as IDADE,
				CASE
					WHEN A.SIT_RUA = "S" THEN "SIM"
				ELSE "NÃO" END PACIENTE_MORA_NA_RUA,
				CASE 
					WHEN TP_DROGA = "A" THEN "ÁLCOOL"
					WHEN TP_DROGA = "C" THEN "CRACK"
				ELSE "OUTROS" END TIPO_DROGA,
				B.COD_MUNICIP  as CODIGO_HOSPITAL,
				B.STATUS as STATUS_MUNICIPIO,
				B.CO_TIPO AS TIPO_UNIDADE,
				B.DS_NOMEPAD AS MUNICIPIO_HOSPITAL,
				B.NU_LATITUD AS LATITUDE,
				B.NU_LONGIT AS LONGITUDE,
				B.CO_UF,
				C.DS_SIGLA,
				C.DS_NOMEPAD AS ESTADOS
  			from unionall as A
  			inner join TABELA_MUNICIPIOv2 as B on a.UFMUN = b.COD_MUNICIP
  			inner join TABELA_UF as C on B.CO_UF = C.CO_UF ')



TB_MUNICIPIO <- sqldf('select 
				B.COD_MUNICIP  as CODIGO_HOSPITAL,
				B.STATUS as STATUS_MUNICIPIO,
				B.CO_TIPO AS TIPO_UNIDADE,
				B.DS_NOMEPAD AS MUNICIPIO_HOSPITAL,
				B.NU_LATITUD AS LATITUDE,
				B.NU_LONGIT AS LONGITUDE,
				B.CO_UF,
				C.DS_SIGLA,
				C.DS_NOMEPAD AS ESTADOS
  			 FROM TABELA_MUNICIPIOv2 as B 
  			inner join TABELA_UF as C on B.CO_UF = C.CO_UF ')



MORTALIDADE <- sqldf('
SELECT
	"MORTALIDADE " AS TIPO_DO_DADO,
	CASE
		WHEN TIPOBITO = "1" THEN "ÓBITO FETAL"
	ELSE "ÓBITO NÃO FETAL" END TIPO_OBITO,
	DTOBITO AS DATA_OBITO,
	HORAOBITO AS HORA_OBITO,
	DTNASC AS DATA_DE_NASCIMENTO,
	CASE
		WHEN SEXO = "1" THEN "MASCULINO"
		WHEN SEXO = "2" THEN "FEMININO"
	ELSE "IGNORADO" END SEXO,
	CASE 
		WHEN RACACOR = "1" THEN "Branca" 
		WHEN RACACOR = "2" THEN "Preta"
		WHEN RACACOR = "3" THEN "Amarela"
		WHEN RACACOR = "4" THEN "Parda"
		WHEN RACACOR = "5" THEN "Indígena"
	ELSE "Não Informado" END RACA,
	CASE
		WHEN ESTCIV = "1" THEN "SOLTEIRO"
		WHEN ESTCIV = "2" THEN "CASADO"
		WHEN ESTCIV = "3" THEN "VIÚVO"
		WHEN ESTCIV = "4" THEN "SEPARADO JUDICIALMENTE"
	ELSE "IGNORADO" END ESTADO_CIVIL,
	CASE 
		WHEN ESC = "1" THEN "NENHUMA"
		WHEN ESC = "2" THEN "1 A 3 ANOS"
		WHEN ESC = "3" THEN "4 A 7 ANOS"
		WHEN ESC = "4" THEN "8 A 11 ANOS"
		WHEN ESC = "5" THEN "12 E MAIS"
	ELSE "IGNORADO" END ANOS_DE_ESCOLARIDADE,
	CASE
		WHEN LOCOCOR = "1" THEN "HOSPITAL"
		WHEN LOCOCOR = "2" THEN "OUTRO ESTAB SAÚDE"
		WHEN LOCOCOR = "3" THEN "DOMICÍLIO"
		WHEN LOCOCOR = "4" THEN "VIA PÚBLICA"
		WHEN LOCOCOR = "5" THEN "OUTROS"
	ELSE "IGNORADO" END LOCAL_DO_OBITO,

	CASE
		WHEN CIRCOBITO = "1" THEN "ACIDENTE"
		WHEN CIRCOBITO = "2" THEN "SUICÍDIO"
		WHEN CIRCOBITO = "3" THEN "HOMICÍDIO"
		WHEN CIRCOBITO = "4" THEN "OUTROS"
	ELSE "IGNORADO" END TIPO_DE_ACIDENTE,
	CASE
		WHEN ACIDTRAB = "1" THEN "SIM"
		WHEN ACIDTRAB = "2" THEN "NÃO"
	ELSE "IGNORADO" END ACIDENTE_DE_TRABALHO,
	CASE
		WHEN TPPOS = "1" THEN "SIM"
	ELSE "NÃO" END OBITO_INVESTIGADO,
	F.DESCR AS CAUSA_DO_OBITO,
	CASE 
		WHEN IDADEMAE IS NULL THEN "NÃO INFORMADO"
	ELSE IDADEMAE END IDADE_MAE,
	CASE 
		WHEN ESCMAE = "1" THEN "NENHUMA"
		WHEN ESCMAE = "2" THEN "1 A 3 ANOS"
		WHEN ESCMAE = "3" THEN "4 A 7 ANOS"
		WHEN ESCMAE = "4" THEN "8 A 11 ANOS"
		WHEN ESCMAE = "5" THEN "12 E MAIS"
	ELSE "IGNORADO" END ANOS_DE_ESCOLARIDADE_DA_MAE,
	CASE
		WHEN OBITOGRAV = "1" THEN "SIM"
		WHEN OBITOGRAV = "2" THEN "NÃO"
	ELSE "IGNORADO" END MORTE_DURANTE_GRAVIDEZ,
	B.DS_NOMEPAD AS MUNICIPIO_RESIDENCIA_FALECIDO,
	B.NU_LATITUD AS MUNICIPIO_RESIDENCIA_FALECIDO_LATITUDE,
	B.NU_LONGIT AS MUNICIPIO_RESIDENCIA_FALECIDO_LONGITUDE,
	D.DS_NOMEPAD AS ESTADO_RESIDENCIA_FALECIDO,
	C.DS_NOMEPAD AS MUNICIPIO_DE_OCORRENCIA_DO_OBITO,
	C.NU_LATITUD AS MUNICIPIO_DE_OCORRENCIA_DO_OBITO_LATITUDE,
	C.NU_LONGIT AS MUNICIPIO_DE_OCORRENCIA_DO_OBITO_LONGITUDE,
	E.DS_NOMEPAD AS ESTADO_DE_OCORRENCIA_DO_OBITO
FROM unionall AS A
INNER JOIN TABELA_MUNICIPIOv2 as B on A.CODMUNRES = B.COD_MUNICIP
INNER JOIN TABELA_MUNICIPIOv2 as C on A.CODMUNOCOR = C.COD_MUNICIP
INNER JOIN TABELA_UF as D on B.CO_UF = D.CO_UF
INNER JOIN TABELA_UF as E on C.CO_UF = E.CO_UF
INNER JOIN CID10_CAUSA_DE_OBITO AS F ON A.CAUSABAS = F.CID10
')

